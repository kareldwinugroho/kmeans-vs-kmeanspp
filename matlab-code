clc;
clear all;
close all;

%%% Data
z=[764.5804104	356.107383
786.0000614	346.1375791
812.2877569	355.5603269
844.3735164	277.1478183
886.3481807	258.2081152
936.8914939	298.0960033
934.8230552	291.1491107
1000.210889	281.3681811
1040.719223	282.0459518
1031.471401	293.7701435
1053.515122	253.4807672
1054.167584	279.4898401
1036.993493	279.7104087
970.2677984	332.0445459
999.0770943	322.3685044
976.798222	377.2812912
894.3104894	354.6617688
868.9258468	422.404305
859.2586142	415.2279351
765.5015412	450.4618129
763.2351419	440.5273172
780.7698286	443.8287737
777.1501696	420.4376742
870.0643417	410.2558032
894.074679	374.8293591
910.3912621	343.0752959
926.2443051	318.7484999
1005.98566	292.5100465
1028.137166	269.1679963
982.0783366	273.508323
1016.992643	241.7743016
961.7870098	283.083151
907.4270989	296.1432341
897.2901424	337.4273519
842.4813314	368.9647858
807.4997707	368.2835499
799.2671807	389.8062658
778.5218438	429.9679687
824.1332819	474.3792922
852.765479	464.7712016
842.9376775	427.564864
922.72598	410.4334945
979.1350109	420.6634349
1007.204096	416.5059301
995.4146884	377.2846693
1046.864496	289.0774991
1085.098298	295.5699127
1059.773823	289.8245371
1030.541191	334.2123562
1032.619006	343.1875146
979.8153473	390.1280855
921.1348491	443.6953478
925.1302061	434.9792659
891.0373643	467.742065
834.7510131	445.1545029
863.2857656	459.5106469
820.6680808	451.0671162
789.0798562	449.9023775
752.760682	479.8202954
791.7238476	493.6203006
793.1434857	516.7025465
869.5331051	518.5325903
930.6293959	476.9203578
920.2150921	479.5708045
932.8539389	463.9252674
954.0072425	435.1994547
957.2624163	429.2830985
863.4491106	498.399792
837.9474414	484.5221913
868.6879782	479.4822089
856.4431351	492.4545887
852.3347662	449.6919625
763.3175623	449.7641019
749.3506233	442.7977227
748.2389813	466.6382802
747.4993681	441.6601903
769.7742783	448.9076857
758.0216939	450.9825023
752.4905625	427.1889792
796.9862281	384.766567
811.1060751	406.6902081
903.1453403	362.782756
901.5195307	356.228319
920.3621593	359.6407551
968.7409271	359.1396654
1005.852052	320.1068922
975.3678917	383.4340992
1010.92513	386.2431865
553.1604483	709.827927
539.7555929	643.1121098
597.5847824	646.6299601
589.2980622	668.9092641
623.4363036	616.0140787
665.7126886	640.9161701
633.4778187	648.4561718
671.7417568	630.2159271
645.4758569	679.2887614
622.5154599	692.4232399
643.0223205	671.8001128
598.7097703	701.7452151
539.1123811	690.0629746
534.9241948	717.8171794
471.0994012	683.7437974
465.3842027	738.7821161
506.5833924	735.6418242
455.27069	698.7647775
534.1920144	689.4352778
564.3954123	672.381097
635.9297739	669.8645818
655.3728675	671.2438124
676.141008	672.8923512
677.7849201	724.1309534
745.5412196	733.4184466
728.0468758	692.8700481
720.1855299	700.7061758
670.9670056	745.698087
640.9334429	740.3570571
646.8485437	743.6282205
616.1575905	771.00783
538.6538118	794.0856369
498.1079512	767.3697674
507.0598747	783.949958
459.3281785	786.0607786
555.1147619	772.9603401
561.1323893	744.2937174
587.6019377	681.248029
631.9149358	719.5855459
627.5598315	654.9048151
687.0711513	679.2159652
720.0659556	655.8440734
731.3096391	671.4708322
799.8654134	631.4490088
776.578737	648.9651732
757.7616698	708.5454075
782.3184215	698.7195942
737.5674181	780.4358828
718.3947176	762.5024951
753.2390965	771.1388179
711.4562149	785.412613
724.915674	810.6561786
685.3331559	832.2461658
685.9813732	841.328868
736.6472677	787.3623759
759.2154174	741.942311
715.00728	697.7450032
771.5587222	650.434409
756.4264831	653.6250814
730.4015692	682.4690339
719.505731	711.1325849
703.4172301	747.664145
648.4145208	778.8831464
663.2685278	793.8441079
664.5441835	771.2743144
653.8258428	777.5225489
613.8837779	795.0414605
547.3799417	788.4189797
495.7367603	758.2145547
467.1598238	790.2641581
452.3098566	787.0404972
484.9670203	733.0337581
516.4973522	765.9373258
522.9924646	697.5194217
502.053015	712.548646
566.8364386	660.8527683
635.3808158	652.8000145
626.1754841	618.1856334
688.1074511	684.1203744
691.1640527	675.2789849
689.3341293	681.2714641
719.4942476	711.4228831
768.3614713	684.552663
700.3122341	695.512319
728.5551187	713.852261
664.8503591	766.659593
658.58786	722.0395493
661.1957125	751.1556138
605.0024555	762.7336269
622.7525615	793.5102718
599.7717962	772.8955514
611.2616162	748.2267763
935.5530593	678.3836096
958.642695	656.4201382
914.6935799	636.4198878
956.5722884	673.8724445
953.6765122	632.1708743
891.2091335	663.5131658
910.4020262	713.463
874.2971341	719.5079177
858.9976698	726.2000559
863.8006109	754.755507
843.0173756	744.0124126
832.6552315	774.5701678
850.4765802	773.1396373
895.9365346	767.8015221
881.1335325	701.5631656
867.4811852	681.2664023
880.7820754	656.034742
896.6034325	648.3148029
955.1750317	653.3121113
959.1870271	670.0101429
971.0465704	675.4130689
986.0796773	672.4449903
1011.004425	676.1536771
1035.163119	709.9577272
1010.256619	732.4315563
1028.027857	776.4482955
1002.058336	789.3227273
1032.182126	780.9218743
1053.905565	754.0503912
1045.452815	792.0642294
1045.544346	792.476037
971.9309284	859.1035033
950.3362076	859.9163947
966.6033443	864.4486952
997.572921	823.1525518
915.7038501	753.6778319
912.0208283	781.8950251
963.1427086	725.657123
970.8427033	726.6675771
900.9360369	746.7080745
940.569842	722.0448447
895.1766056	800.3818754
892.4451982	792.1394979
902.6096874	804.6466807
853.2396519	819.8740524
877.6842124	802.7194881
935.7109106	802.456208
998.0981379	722.6500271
986.618309	687.1395569
1032.749245	716.4002769
1080.063806	716.39817
1112.990189	707.097578
1087.143593	679.9999967
1123.535161	682.8811622
1149.833771	733.4874982
1143.698863	765.9091297
1135.20261	759.5017443
1159.559596	758.9480533
1088.238166	769.4743954
1092.032095	805.8979124
1011.084121	776.9948109
997.9090539	729.4223534
968.0170592	715.1834249
1007.873544	729.6019752
968.7957327	698.4074858
1045.532026	658.9900445
1058.485175	624.9831607
1036.588816	640.3394322
1121.917848	607.3844336
1154.093254	665.3400609
1174.089337	721.2143884
1196.471156	753.1928266
1170.63412	786.3727074
1174.575678	795.3487186
1166.220916	800.8986197
1179.054927	818.9827824
1200.196587	853.5430645
1143.649042	853.5365168
1127.743233	842.4284349
1080.358821	816.1613693
1087.138675	846.5614711
1039.799325	805.7783634
1058.709125	811.6330582
1066.770982	759.5040448
1089.345485	761.4073539
1156.29844	715.3987839
1136.086269	724.0621931
1134.439313	723.8089761
1158.354176	779.0870937
1091.575948	737.58994
1082.826832	757.9123169
1078.125109	707.8465744
1060.817843	745.1404948
1036.603301	741.9600195];
x=double(z(:,1));
y=double(z(:,2));

%%% Kode untuk K-means
figure;
plot(x,y,'b.','linewidth',1);
xlabel('x');
ylabel('y');
title('Titik-titik Tengah Kelompok Awal menggunakan K-means');
hold on;

k=3;
pos = [];
startx = [];
starty = [];
center = zeros(3,2);
for i=1:3
    pos(i) = randi(length(x));
    startx(i)=x(pos(i));
    starty(i)=y(pos(i));
    center(i,:)=[startx(i) starty(i)];
    plot(center(i,1),center(i,2),'ko','linewidth',2);
end
grid on;
hold off;

cluster1=[];
cluster2=[];
cluster3=[];

while (~isequal(cluster1,cluster1) ...
        & ~isequal(cluster2,cluster2) ...
        & ~isequal(cluster3,cluster3)) ...
        | (isempty(cluster1) ...
        & isempty(cluster2) ...
        & isempty(cluster3))
    for i=1:length(x)
        tx = x(i);
        ty = y(i);
        jarak = sqrt((tx - center(:, 1)).^ 2 + (ty - center(:, 2)).^ 2);
        [minJarak, Index(i)] = min(jarak);
        if Index(i)==1
            cluster1=[cluster1;[tx ty]];
        elseif Index(i)==2
            cluster2=[cluster2;[tx ty]];
        else
            cluster3=[cluster3;[tx ty]];
    end
end

center(1,1)=mean(cluster1(:,1));
center(1,2)=mean(cluster1(:,2));

center(2,1)=mean(cluster2(:,1));
center(2,2)=mean(cluster2(:,2));

center(3,1)=mean(cluster3(:,1));
center(3,2)=mean(cluster3(:,2));
end

figure;
hold on;
plot(cluster1(:,1),cluster1(:,2),'r.','linewidth',1);
plot(cluster2(:,1),cluster2(:,2),'b.','linewidth',1);
plot(cluster3(:,1),cluster3(:,2),'m.','linewidth',1);
plot(center(:,1),center(:,2),'ko','linewidth',2);
legend({'Kelompok 1','Kelompok 2','Kelompok 3','Titik-titik tengah'},...
    'Location','southwest');
grid on;
xlabel('x');
ylabel('y');
title('Pengelompokan dengan K-means');

%%% Kode untuk K-means++
figure;
plot(x,y,'b.','linewidth',1);
xlabel('x');
ylabel('y');
title('Titik-titik Tengah Kelompok Awal menggunakan K-means++');
hold on;
m=[];
pos = randi(length(x));
startx=x(pos);
starty=y(pos);
center=[startx starty];
d=[];
r=1;
while(r~=k)
for i=1:length(x)
    g=[x(i) y(i)];
    ka=dsearchn(center,g);
    nearestx=center(ka,1);
    nearesty=center(ka,2);
    distance=sqrt((nearestx-g(1))^2+(nearesty-g(2))^2);
    d=[d distance];
end
[e s]=max(d);
center=[center;[x(s) y(s)]];
x(s)=[];
y(s)=[];
[r c]=size(center);
d=[];
end
disp(center);

plot(center(1,1),center(1,2),'ro','linewidth',2);
plot(center(2,1),center(2,2),'go','linewidth',2);
plot(center(3,1),center(3,2),'mo','linewidth',2);

grid on;
hold off;
x=double(z(:,1));
y=double(z(:,2));
cx=center(:,1);
cy=center(:,2);
mean_oldx=cx;
mean_newx=cx;
mean_oldy=cy;
mean_newy=cy;
outputx=cell(k,1);
outputy=cell(k,1);
temp=0;
while(temp==0)
    mean_oldx=mean_newx;
    mean_oldy=mean_newy;
    for ij=1:length(x)
        mina=[];
        mu=x(ij);
        nu=y(ij);
     for mk=1:length(cx)
         mina=[mina sqrt((mu-cx(mk))^2+(nu-cy(mk))^2)];
     end
     [gc index]=min(mina);
     outputx{index}=[outputx{index} mu];
     outputy{index}=[outputy{index} nu];
    end
    gmckx=[];
    gmcky=[];
    for i=1:k
        gmckx=[gmckx mean(outputx{i})];
        gmcky=[gmcky mean(outputy{i})];
    end
    cx=gmckx;
    cy=gmcky;
    mean_newx=cx;
        mean_newy=cy;
        gum=0;
        bum=0;
    if(mean_newx==mean_oldx)
        gum=1;
    end
    if(mean_newy==mean_oldy)
        bum=1;
    end
    if(gum==1 && bum==1)
        temp=1;
    else
            outputx=cell(k,1);
            outputy=cell(k,1);
    end
end
celldisp(outputx);
celldisp(outputy);
figure;
for i=1:k
    x=outputx{i};
    y=outputy{i};
    if(i==1)
        plot(x,y,'r.','linewidth',1);
    elseif(i==2)
        plot(x,y,'b.','linewidth',1);
    else
        plot(x,y,'m.','linewidth',1);
    end
    hold on;
    grid on;
end
plot(cx,cy,'ko','linewidth',2);
legend({'Kelompok 1','Kelompok 2','Kelompok 3','Titik-titik tengah'},...
    'Location','southwest');
xlabel('x');
ylabel('y');
title('Pengelompokan dengan K-means++');
